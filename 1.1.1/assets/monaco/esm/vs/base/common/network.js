import*as platform from"./platform.js";import{URI}from"./uri.js";export var Schemas;!function(Schemas){Schemas.inMemory="inmemory",Schemas.vscode="vscode",Schemas.internal="private",Schemas.walkThrough="walkThrough",Schemas.walkThroughSnippet="walkThroughSnippet",Schemas.http="http",Schemas.https="https",Schemas.file="file",Schemas.mailto="mailto",Schemas.untitled="untitled",Schemas.data="data",Schemas.command="command",Schemas.vscodeRemote="vscode-remote",Schemas.vscodeRemoteResource="vscode-remote-resource",Schemas.vscodeUserData="vscode-userdata",Schemas.vscodeCustomEditor="vscode-custom-editor",Schemas.vscodeNotebook="vscode-notebook",Schemas.vscodeNotebookCell="vscode-notebook-cell",Schemas.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",Schemas.vscodeNotebookCellOutput="vscode-notebook-cell-output",Schemas.vscodeInteractive="vscode-interactive",Schemas.vscodeInteractiveInput="vscode-interactive-input",Schemas.vscodeSettings="vscode-settings",Schemas.vscodeWorkspaceTrust="vscode-workspace-trust",Schemas.vscodeTerminal="vscode-terminal",Schemas.webviewPanel="webview-panel",Schemas.vscodeWebview="vscode-webview",Schemas.extension="extension",Schemas.vscodeFileResource="vscode-file",Schemas.tmp="tmp",Schemas.vsls="vsls",Schemas.vscodeSourceControl="vscode-scm"}(Schemas||(Schemas={}));export const connectionTokenQueryName="tkn";class RemoteAuthoritiesImpl{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null,this._remoteResourcesPath=`/${Schemas.vscodeRemoteResource}`}setPreferredWebSchema(schema){this._preferredWebSchema=schema}rewrite(uri){if(this._delegate)return this._delegate(uri);const authority=uri.authority;let host=this._hosts[authority];host&&-1!==host.indexOf(":")&&(host=`[${host}]`);const port=this._ports[authority],connectionToken=this._connectionTokens[authority];let query=`path=${encodeURIComponent(uri.path)}`;return"string"==typeof connectionToken&&(query+=`&tkn=${encodeURIComponent(connectionToken)}`),URI.from({scheme:platform.isWeb?this._preferredWebSchema:Schemas.vscodeRemoteResource,authority:`${host}:${port}`,path:this._remoteResourcesPath,query})}}export const RemoteAuthorities=new RemoteAuthoritiesImpl;class FileAccessImpl{asBrowserUri(uriOrModule,moduleIdToUrl){const uri=this.toUri(uriOrModule,moduleIdToUrl);return uri.scheme===Schemas.vscodeRemote?RemoteAuthorities.rewrite(uri):uri.scheme===Schemas.file&&(platform.isNative||platform.isWebWorker&&platform.globals.origin===`${Schemas.vscodeFileResource}://${FileAccessImpl.FALLBACK_AUTHORITY}`)?uri.with({scheme:Schemas.vscodeFileResource,authority:uri.authority||FileAccessImpl.FALLBACK_AUTHORITY,query:null,fragment:null}):uri}toUri(uriOrModule,moduleIdToUrl){return URI.isUri(uriOrModule)?uriOrModule:URI.parse(moduleIdToUrl.toUrl(uriOrModule))}}FileAccessImpl.FALLBACK_AUTHORITY="vscode-app";export const FileAccess=new FileAccessImpl;