import{$,append}from"../../dom.js";import{BaseActionViewItem}from"../actionbar/actionViewItems.js";import{DropdownMenu}from"./dropdown.js";import{Emitter}from"../../../common/event.js";import"./dropdown.css";export class DropdownMenuActionViewItem extends BaseActionViewItem{constructor(action,menuActionsOrProvider,contextMenuProvider,options=Object.create(null)){super(null,action,options),this.actionItem=null,this._onDidChangeVisibility=this._register(new Emitter),this.menuActionsOrProvider=menuActionsOrProvider,this.contextMenuProvider=contextMenuProvider,this.options=options,this.options.actionRunner&&(this.actionRunner=this.options.actionRunner)}render(container){this.actionItem=container;const isActionsArray=Array.isArray(this.menuActionsOrProvider),options={contextMenuProvider:this.contextMenuProvider,labelRenderer:el=>{this.element=append(el,$("a.action-label"));let classNames=[];return"string"==typeof this.options.classNames?classNames=this.options.classNames.split(/\s+/g).filter((s=>!!s)):this.options.classNames&&(classNames=this.options.classNames),classNames.find((c=>"icon"===c))||classNames.push("codicon"),this.element.classList.add(...classNames),this.element.setAttribute("role","button"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.title=this._action.label||"",this.element.ariaLabel=this._action.label||"",null},menuAsChild:this.options.menuAsChild,actions:isActionsArray?this.menuActionsOrProvider:void 0,actionProvider:isActionsArray?void 0:this.menuActionsOrProvider};if(this.dropdownMenu=this._register(new DropdownMenu(container,options)),this._register(this.dropdownMenu.onDidChangeVisibility((visible=>{var _a;null===(_a=this.element)||void 0===_a||_a.setAttribute("aria-expanded",`${visible}`),this._onDidChangeVisibility.fire(visible)}))),this.dropdownMenu.menuOptions={actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,getKeyBinding:this.options.keybindingProvider,context:this._context},this.options.anchorAlignmentProvider){const that=this;this.dropdownMenu.menuOptions=Object.assign(Object.assign({},this.dropdownMenu.menuOptions),{get anchorAlignment(){return that.options.anchorAlignmentProvider()}})}this.updateTooltip(),this.updateEnabled()}getTooltip(){let title=null;return this.getAction().tooltip?title=this.getAction().tooltip:this.getAction().label&&(title=this.getAction().label),null!=title?title:void 0}setActionContext(newContext){super.setActionContext(newContext),this.dropdownMenu&&(this.dropdownMenu.menuOptions?this.dropdownMenu.menuOptions.context=newContext:this.dropdownMenu.menuOptions={context:newContext})}updateEnabled(){var _a,_b;const disabled=!this.getAction().enabled;null===(_a=this.actionItem)||void 0===_a||_a.classList.toggle("disabled",disabled),null===(_b=this.element)||void 0===_b||_b.classList.toggle("disabled",disabled)}}