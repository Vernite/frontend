import{Position}from"./core/position.js";import{Range}from"./core/range.js";import{Selection}from"./core/selection.js";import{createScopedLineTokens}from"./languages/supports.js";import{CursorColumns}from"./core/cursorColumns.js";import{normalizeIndentation}from"./core/indentation.js";const autoCloseAlways=()=>!0,autoCloseNever=()=>!1,autoCloseBeforeWhitespace=chr=>" "===chr||"\t"===chr;export class CursorConfiguration{constructor(languageId,modelOptions,configuration,languageConfigurationService){this.languageConfigurationService=languageConfigurationService,this._cursorMoveConfigurationBrand=void 0,this._languageId=languageId;const options=configuration.options,layoutInfo=options.get(133);this.readOnly=options.get(83),this.tabSize=modelOptions.tabSize,this.indentSize=modelOptions.indentSize,this.insertSpaces=modelOptions.insertSpaces,this.stickyTabStops=options.get(106),this.lineHeight=options.get(61),this.pageSize=Math.max(1,Math.floor(layoutInfo.height/this.lineHeight)-2),this.useTabStops=options.get(118),this.wordSeparators=options.get(119),this.emptySelectionClipboard=options.get(33),this.copyWithSyntaxHighlighting=options.get(21),this.multiCursorMergeOverlapping=options.get(71),this.multiCursorPaste=options.get(73),this.autoClosingBrackets=options.get(5),this.autoClosingQuotes=options.get(8),this.autoClosingDelete=options.get(6),this.autoClosingOvertype=options.get(7),this.autoSurround=options.get(11),this.autoIndent=options.get(9),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(languageId,this.autoClosingQuotes),bracket:this._getShouldAutoClose(languageId,this.autoClosingBrackets)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(languageId).getAutoClosingPairs();const surroundingPairs=this.languageConfigurationService.getLanguageConfiguration(languageId).getSurroundingPairs();if(surroundingPairs)for(const pair of surroundingPairs)this.surroundingPairs[pair.open]=pair.close}static shouldRecreate(e){return e.hasChanged(133)||e.hasChanged(119)||e.hasChanged(33)||e.hasChanged(71)||e.hasChanged(73)||e.hasChanged(5)||e.hasChanged(8)||e.hasChanged(6)||e.hasChanged(7)||e.hasChanged(11)||e.hasChanged(118)||e.hasChanged(61)||e.hasChanged(83)}get electricChars(){var _a;if(!this._electricChars){this._electricChars={};const electricChars=null===(_a=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)||void 0===_a?void 0:_a.getElectricCharacters();if(electricChars)for(const char of electricChars)this._electricChars[char]=!0}return this._electricChars}onElectricCharacter(character,context,column){const scopedLineTokens=createScopedLineTokens(context,column-1),electricCharacterSupport=this.languageConfigurationService.getLanguageConfiguration(scopedLineTokens.languageId).electricCharacter;return electricCharacterSupport?electricCharacterSupport.onElectricCharacter(character,scopedLineTokens,column-scopedLineTokens.firstCharOffset):null}normalizeIndentation(str){return normalizeIndentation(str,this.indentSize,this.insertSpaces)}_getShouldAutoClose(languageId,autoCloseConfig){switch(autoCloseConfig){case"beforeWhitespace":return autoCloseBeforeWhitespace;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(languageId);case"always":return autoCloseAlways;case"never":return autoCloseNever}}_getLanguageDefinedShouldAutoClose(languageId){const autoCloseBeforeSet=this.languageConfigurationService.getLanguageConfiguration(languageId).getAutoCloseBeforeSet();return c=>-1!==autoCloseBeforeSet.indexOf(c)}visibleColumnFromColumn(model,position){return CursorColumns.visibleColumnFromColumn(model.getLineContent(position.lineNumber),position.column,this.tabSize)}columnFromVisibleColumn(model,lineNumber,visibleColumn){const result=CursorColumns.columnFromVisibleColumn(model.getLineContent(lineNumber),visibleColumn,this.tabSize),minColumn=model.getLineMinColumn(lineNumber);if(result<minColumn)return minColumn;const maxColumn=model.getLineMaxColumn(lineNumber);return result>maxColumn?maxColumn:result}}export class CursorState{constructor(modelState,viewState){this._cursorStateBrand=void 0,this.modelState=modelState,this.viewState=viewState}static fromModelState(modelState){return new PartialModelCursorState(modelState)}static fromViewState(viewState){return new PartialViewCursorState(viewState)}static fromModelSelection(modelSelection){const selection=Selection.liftSelection(modelSelection),modelState=new SingleCursorState(Range.fromPositions(selection.getSelectionStart()),0,selection.getPosition(),0);return CursorState.fromModelState(modelState)}static fromModelSelections(modelSelections){const states=[];for(let i=0,len=modelSelections.length;i<len;i++)states[i]=this.fromModelSelection(modelSelections[i]);return states}equals(other){return this.viewState.equals(other.viewState)&&this.modelState.equals(other.modelState)}}export class PartialModelCursorState{constructor(modelState){this.modelState=modelState,this.viewState=null}}export class PartialViewCursorState{constructor(viewState){this.modelState=null,this.viewState=viewState}}export class SingleCursorState{constructor(selectionStart,selectionStartLeftoverVisibleColumns,position,leftoverVisibleColumns){this._singleCursorStateBrand=void 0,this.selectionStart=selectionStart,this.selectionStartLeftoverVisibleColumns=selectionStartLeftoverVisibleColumns,this.position=position,this.leftoverVisibleColumns=leftoverVisibleColumns,this.selection=SingleCursorState._computeSelection(this.selectionStart,this.position)}equals(other){return this.selectionStartLeftoverVisibleColumns===other.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===other.leftoverVisibleColumns&&this.position.equals(other.position)&&this.selectionStart.equalsRange(other.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(inSelectionMode,lineNumber,column,leftoverVisibleColumns){return inSelectionMode?new SingleCursorState(this.selectionStart,this.selectionStartLeftoverVisibleColumns,new Position(lineNumber,column),leftoverVisibleColumns):new SingleCursorState(new Range(lineNumber,column,lineNumber,column),leftoverVisibleColumns,new Position(lineNumber,column),leftoverVisibleColumns)}static _computeSelection(selectionStart,position){return selectionStart.isEmpty()||!position.isBeforeOrEqual(selectionStart.getStartPosition())?Selection.fromPositions(selectionStart.getStartPosition(),position):Selection.fromPositions(selectionStart.getEndPosition(),position)}}export class EditOperationResult{constructor(type,commands,opts){this._editOperationResultBrand=void 0,this.type=type,this.commands=commands,this.shouldPushStackElementBefore=opts.shouldPushStackElementBefore,this.shouldPushStackElementAfter=opts.shouldPushStackElementAfter}}export function isQuote(ch){return"'"===ch||'"'===ch||"`"===ch}