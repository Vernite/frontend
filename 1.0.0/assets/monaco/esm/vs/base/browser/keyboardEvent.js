import*as browser from"./browser.js";import{EVENT_KEY_CODE_MAP,KeyCodeUtils}from"../common/keyCodes.js";import{SimpleKeybinding}from"../common/keybindings.js";import*as platform from"../common/platform.js";function extractKeyCode(e){if(e.charCode){const char=String.fromCharCode(e.charCode).toUpperCase();return KeyCodeUtils.fromString(char)}const keyCode=e.keyCode;if(3===keyCode)return 7;if(browser.isFirefox){if(59===keyCode)return 80;if(107===keyCode)return 81;if(109===keyCode)return 83;if(platform.isMacintosh&&224===keyCode)return 57}else if(browser.isWebKit){if(91===keyCode)return 57;if(platform.isMacintosh&&93===keyCode)return 57;if(!platform.isMacintosh&&92===keyCode)return 57}return EVENT_KEY_CODE_MAP[keyCode]||0}const ctrlKeyMod=platform.isMacintosh?256:2048,altKeyMod=512,shiftKeyMod=1024,metaKeyMod=platform.isMacintosh?2048:256;export class StandardKeyboardEvent{constructor(source){this._standardKeyboardEventBrand=!0;const e=source;this.browserEvent=e,this.target=e.target,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.metaKey=e.metaKey,this.keyCode=extractKeyCode(e),this.code=e.code,this.ctrlKey=this.ctrlKey||5===this.keyCode,this.altKey=this.altKey||6===this.keyCode,this.shiftKey=this.shiftKey||4===this.keyCode,this.metaKey=this.metaKey||57===this.keyCode,this._asKeybinding=this._computeKeybinding(),this._asRuntimeKeybinding=this._computeRuntimeKeybinding()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeybinding(){return this._asRuntimeKeybinding}equals(other){return this._asKeybinding===other}_computeKeybinding(){let key=0;5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(key=this.keyCode);let result=0;return this.ctrlKey&&(result|=ctrlKeyMod),this.altKey&&(result|=512),this.shiftKey&&(result|=1024),this.metaKey&&(result|=metaKeyMod),result|=key,result}_computeRuntimeKeybinding(){let key=0;return 5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(key=this.keyCode),new SimpleKeybinding(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,key)}}