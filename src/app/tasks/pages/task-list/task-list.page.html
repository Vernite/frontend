<app-view-options [project]="(project$ | async)!"></app-view-options>

<!-- Table -->
<div class="table">

  <!-- Header -->
  <div class="header-row">
    <div class="header-cell w-full">Title</div>
    <div class="header-cell w-52">Status</div>
    <div class="header-cell w-52">Assignee</div>
    <div class="header-cell w-52">Deadline</div>
    <div class="header-cell action">
      <!-- Actions -->
    </div>
  </div>

  <!-- Body -->
  <ng-container *ngFor="let task of taskList$ | async">
    <div class="row" [class.expanded]="expandedSubtasks.has(task.id)" (click)="expandedSubtasks.toggle(task.id)">

      <!-- Title cell -->
      <div class="cell w-full">
        <div class="task-title">
          <app-icon [icon]="faChevronRight" size="16px" [class.invisible]="!task.subTasks?.length"></app-icon>
          <span>{{ task.name }}</span>
        </div>
      </div>

      <!-- Status cell -->
      <div class="cell w-52 p-0">
        <div class="status">{{ task.statusId && getStatus(task.statusId) }}</div>
      </div>

      <!-- Assignee cell -->
      <div class="cell w-52">-</div>

      <!-- Deadline cell -->
      <div class="cell w-52">-</div>

      <!-- Actions cell -->
      <div class="cell action justify-center">
        <button mat-icon-button [matMenuTriggerFor]="menu" class="flex items-center">
          <app-icon icon="matMoreVert"></app-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item>
            <span i18n>Edit task</span>
          </button>
          <button mat-menu-item (click)="createSubtask(task)">
            <span i18n>Create subtask</span>
          </button>
          <button mat-menu-item class="important">
            <span i18n>Delete task</span>
          </button>
        </mat-menu>
      </div>
    </div>
    <div class="subtasks">
      <div *ngFor="let subtask of task.subTasks" class="row">

        <!-- Title cell -->
        <div class="cell w-full">
          <div class="task-title">
            <span>{{ subtask.name }}</span>
          </div>
        </div>

        <!-- Status cell -->
        <div class="cell w-52 p-0">
          <div class="status">{{ subtask.statusId && getStatus(subtask.statusId) }}</div>
        </div>

        <!-- Assignee cell -->
        <div class="cell w-52">-</div>

        <!-- Deadline cell -->
        <div class="cell w-52">-</div>

        <!-- Actions cell -->
        <div class="cell action justify-center">
          <button mat-icon-button [matMenuTriggerFor]="menu" class="flex items-center">
            <app-icon icon="matMoreVert"></app-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item>
              <span i18n>Edit task</span>
            </button>
            <button mat-menu-item (click)="createSubtask(subtask)">
              <span i18n>Create subtask</span>
            </button>
            <button mat-menu-item class="important">
              <span i18n>Delete task</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </div>
  </ng-container>
</div>
