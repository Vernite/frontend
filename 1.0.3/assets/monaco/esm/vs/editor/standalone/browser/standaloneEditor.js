import"./standalone-tokens.css";import{Disposable,DisposableStore}from"../../../base/common/lifecycle.js";import{splitLines}from"../../../base/common/strings.js";import{FontMeasurements}from"../../browser/config/fontMeasurements.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{DiffNavigator}from"../../browser/widget/diffNavigator.js";import{ApplyUpdateResult,ConfigurationChangedEvent,EditorOptions}from"../../common/config/editorOptions.js";import{BareFontInfo,FontInfo}from"../../common/config/fontInfo.js";import{EditorType}from"../../common/editorCommon.js";import{FindMatch,TextModelResolvedOptions}from"../../common/model.js";import*as languages from"../../common/languages.js";import{ILanguageConfigurationService}from"../../common/languages/languageConfigurationRegistry.js";import{NullState,nullTokenize}from"../../common/languages/nullTokenize.js";import{ILanguageService}from"../../common/languages/language.js";import{IModelService}from"../../common/services/model.js";import{createWebWorker as actualCreateWebWorker}from"../../browser/services/webWorker.js";import*as standaloneEnums from"../../common/standalone/standaloneEnums.js";import{Colorizer}from"./colorizer.js";import{createTextModel,StandaloneDiffEditor,StandaloneEditor}from"./standaloneCodeEditor.js";import{StandaloneKeybindingService,StandaloneServices}from"./standaloneServices.js";import{IStandaloneThemeService}from"../common/standaloneTheme.js";import{CommandsRegistry}from"../../../platform/commands/common/commands.js";import{IMarkerService}from"../../../platform/markers/common/markers.js";import{IKeybindingService}from"../../../platform/keybinding/common/keybinding.js";import{EditorCommand}from"../../browser/editorExtensions.js";import{MenuRegistry,MenuId}from"../../../platform/actions/common/actions.js";import{ContextKeyExpr}from"../../../platform/contextkey/common/contextkey.js";export function create(domElement,options,override){return StandaloneServices.initialize(override||{}).createInstance(StandaloneEditor,domElement,options)}export function onDidCreateEditor(listener){return StandaloneServices.get(ICodeEditorService).onCodeEditorAdd((editor=>{listener(editor)}))}export function onDidCreateDiffEditor(listener){return StandaloneServices.get(ICodeEditorService).onDiffEditorAdd((editor=>{listener(editor)}))}export function getEditors(){return StandaloneServices.get(ICodeEditorService).listCodeEditors()}export function getDiffEditors(){return StandaloneServices.get(ICodeEditorService).listDiffEditors()}export function createDiffEditor(domElement,options,override){return StandaloneServices.initialize(override||{}).createInstance(StandaloneDiffEditor,domElement,options)}export function createDiffNavigator(diffEditor,opts){return new DiffNavigator(diffEditor,opts)}export function addCommand(descriptor){if("string"!=typeof descriptor.id||"function"!=typeof descriptor.run)throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return CommandsRegistry.registerCommand(descriptor.id,descriptor.run)}export function addEditorAction(descriptor){if("string"!=typeof descriptor.id||"string"!=typeof descriptor.label||"function"!=typeof descriptor.run)throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const precondition=ContextKeyExpr.deserialize(descriptor.precondition),toDispose=new DisposableStore;if(toDispose.add(CommandsRegistry.registerCommand(descriptor.id,((accessor,...args)=>EditorCommand.runEditorCommand(accessor,args,precondition,((accessor,editor,args)=>Promise.resolve(descriptor.run(editor,...args))))))),descriptor.contextMenuGroupId){const menuItem={command:{id:descriptor.id,title:descriptor.label},when:precondition,group:descriptor.contextMenuGroupId,order:descriptor.contextMenuOrder||0};toDispose.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,menuItem))}if(Array.isArray(descriptor.keybindings)){const keybindingService=StandaloneServices.get(IKeybindingService);if(keybindingService instanceof StandaloneKeybindingService){const keybindingsWhen=ContextKeyExpr.and(precondition,ContextKeyExpr.deserialize(descriptor.keybindingContext));toDispose.add(keybindingService.addDynamicKeybindings(descriptor.keybindings.map((keybinding=>({keybinding,command:descriptor.id,when:keybindingsWhen})))))}else console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService")}return toDispose}export function addKeybindingRule(rule){return addKeybindingRules([rule])}export function addKeybindingRules(rules){const keybindingService=StandaloneServices.get(IKeybindingService);return keybindingService instanceof StandaloneKeybindingService?keybindingService.addDynamicKeybindings(rules.map((rule=>({keybinding:rule.keybinding,command:rule.command,commandArgs:rule.commandArgs,when:ContextKeyExpr.deserialize(rule.when)})))):(console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None)}export function createModel(value,language,uri){const languageService=StandaloneServices.get(ILanguageService),languageId=languageService.getLanguageIdByMimeType(language)||language;return createTextModel(StandaloneServices.get(IModelService),languageService,value,languageId,uri)}export function setModelLanguage(model,languageId){const languageService=StandaloneServices.get(ILanguageService);StandaloneServices.get(IModelService).setMode(model,languageService.createById(languageId))}export function setModelMarkers(model,owner,markers){if(model){StandaloneServices.get(IMarkerService).changeOne(owner,model.uri,markers)}}export function removeAllMarkers(owner){StandaloneServices.get(IMarkerService).changeAll(owner,[])}export function getModelMarkers(filter){return StandaloneServices.get(IMarkerService).read(filter)}export function onDidChangeMarkers(listener){return StandaloneServices.get(IMarkerService).onMarkerChanged(listener)}export function getModel(uri){return StandaloneServices.get(IModelService).getModel(uri)}export function getModels(){return StandaloneServices.get(IModelService).getModels()}export function onDidCreateModel(listener){return StandaloneServices.get(IModelService).onModelAdded(listener)}export function onWillDisposeModel(listener){return StandaloneServices.get(IModelService).onModelRemoved(listener)}export function onDidChangeModelLanguage(listener){return StandaloneServices.get(IModelService).onModelLanguageChanged((e=>{listener({model:e.model,oldLanguage:e.oldLanguageId})}))}export function createWebWorker(opts){return actualCreateWebWorker(StandaloneServices.get(IModelService),StandaloneServices.get(ILanguageConfigurationService),opts)}export function colorizeElement(domNode,options){const languageService=StandaloneServices.get(ILanguageService),themeService=StandaloneServices.get(IStandaloneThemeService);return themeService.registerEditorContainer(domNode),Colorizer.colorizeElement(themeService,languageService,domNode,options)}export function colorize(text,languageId,options){const languageService=StandaloneServices.get(ILanguageService);return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(document.body),Colorizer.colorize(languageService,text,languageId,options)}export function colorizeModelLine(model,lineNumber,tabSize=4){return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(document.body),Colorizer.colorizeModelLine(model,lineNumber,tabSize)}function getSafeTokenizationSupport(language){const tokenizationSupport=languages.TokenizationRegistry.get(language);return tokenizationSupport||{getInitialState:()=>NullState,tokenize:(line,hasEOL,state)=>nullTokenize(language,state)}}export function tokenize(text,languageId){languages.TokenizationRegistry.getOrCreate(languageId);const tokenizationSupport=getSafeTokenizationSupport(languageId),lines=splitLines(text),result=[];let state=tokenizationSupport.getInitialState();for(let i=0,len=lines.length;i<len;i++){const line=lines[i],tokenizationResult=tokenizationSupport.tokenize(line,!0,state);result[i]=tokenizationResult.tokens,state=tokenizationResult.endState}return result}export function defineTheme(themeName,themeData){StandaloneServices.get(IStandaloneThemeService).defineTheme(themeName,themeData)}export function setTheme(themeName){StandaloneServices.get(IStandaloneThemeService).setTheme(themeName)}export function remeasureFonts(){FontMeasurements.clearAllFontInfos()}export function registerCommand(id,handler){return CommandsRegistry.registerCommand({id,handler})}export function createMonacoEditorAPI(){return{create,getEditors,getDiffEditors,onDidCreateEditor,onDidCreateDiffEditor,createDiffEditor,createDiffNavigator,addCommand,addEditorAction,addKeybindingRule,addKeybindingRules,createModel,setModelLanguage,setModelMarkers,getModelMarkers,removeAllMarkers,onDidChangeMarkers,getModels,getModel,onDidCreateModel,onWillDisposeModel,onDidChangeModelLanguage,createWebWorker,colorizeElement,colorize,colorizeModelLine,tokenize,defineTheme,setTheme,remeasureFonts,registerCommand,AccessibilitySupport:standaloneEnums.AccessibilitySupport,ContentWidgetPositionPreference:standaloneEnums.ContentWidgetPositionPreference,CursorChangeReason:standaloneEnums.CursorChangeReason,DefaultEndOfLine:standaloneEnums.DefaultEndOfLine,EditorAutoIndentStrategy:standaloneEnums.EditorAutoIndentStrategy,EditorOption:standaloneEnums.EditorOption,EndOfLinePreference:standaloneEnums.EndOfLinePreference,EndOfLineSequence:standaloneEnums.EndOfLineSequence,MinimapPosition:standaloneEnums.MinimapPosition,MouseTargetType:standaloneEnums.MouseTargetType,OverlayWidgetPositionPreference:standaloneEnums.OverlayWidgetPositionPreference,OverviewRulerLane:standaloneEnums.OverviewRulerLane,RenderLineNumbersType:standaloneEnums.RenderLineNumbersType,RenderMinimap:standaloneEnums.RenderMinimap,ScrollbarVisibility:standaloneEnums.ScrollbarVisibility,ScrollType:standaloneEnums.ScrollType,TextEditorCursorBlinkingStyle:standaloneEnums.TextEditorCursorBlinkingStyle,TextEditorCursorStyle:standaloneEnums.TextEditorCursorStyle,TrackedRangeStickiness:standaloneEnums.TrackedRangeStickiness,WrappingIndent:standaloneEnums.WrappingIndent,InjectedTextCursorStops:standaloneEnums.InjectedTextCursorStops,PositionAffinity:standaloneEnums.PositionAffinity,ConfigurationChangedEvent,BareFontInfo,FontInfo,TextModelResolvedOptions,FindMatch,ApplyUpdateResult,EditorType,EditorOptions}}