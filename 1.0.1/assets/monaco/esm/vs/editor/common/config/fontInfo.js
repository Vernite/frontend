import*as platform from"../../../base/common/platform.js";import{EDITOR_FONT_DEFAULTS}from"./editorOptions.js";import{EditorZoom}from"./editorZoom.js";const GOLDEN_LINE_HEIGHT_RATIO=platform.isMacintosh?1.5:1.35,MINIMUM_LINE_HEIGHT=8;export class BareFontInfo{constructor(opts){this._bareFontInfoBrand=void 0,this.pixelRatio=opts.pixelRatio,this.fontFamily=String(opts.fontFamily),this.fontWeight=String(opts.fontWeight),this.fontSize=opts.fontSize,this.fontFeatureSettings=opts.fontFeatureSettings,this.lineHeight=0|opts.lineHeight,this.letterSpacing=opts.letterSpacing}static createFromValidatedSettings(options,pixelRatio,ignoreEditorZoom){const fontFamily=options.get(45),fontWeight=options.get(49),fontSize=options.get(48),fontFeatureSettings=options.get(47),lineHeight=options.get(61),letterSpacing=options.get(58);return BareFontInfo._create(fontFamily,fontWeight,fontSize,fontFeatureSettings,lineHeight,letterSpacing,pixelRatio,ignoreEditorZoom)}static _create(fontFamily,fontWeight,fontSize,fontFeatureSettings,lineHeight,letterSpacing,pixelRatio,ignoreEditorZoom){0===lineHeight?lineHeight=GOLDEN_LINE_HEIGHT_RATIO*fontSize:lineHeight<8&&(lineHeight*=fontSize),(lineHeight=Math.round(lineHeight))<8&&(lineHeight=8);const editorZoomLevelMultiplier=1+(ignoreEditorZoom?0:.1*EditorZoom.getZoomLevel());return new BareFontInfo({pixelRatio,fontFamily,fontWeight,fontSize:fontSize*=editorZoomLevelMultiplier,fontFeatureSettings,lineHeight:lineHeight*=editorZoomLevelMultiplier,letterSpacing})}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const fallbackFontFamily=EDITOR_FONT_DEFAULTS.fontFamily,fontFamily=BareFontInfo._wrapInQuotes(this.fontFamily);return fallbackFontFamily&&this.fontFamily!==fallbackFontFamily?`${fontFamily}, ${fallbackFontFamily}`:fontFamily}static _wrapInQuotes(fontFamily){return/[,"']/.test(fontFamily)?fontFamily:/[+ ]/.test(fontFamily)?`"${fontFamily}"`:fontFamily}}export const SERIALIZED_FONT_INFO_VERSION=1;export class FontInfo extends BareFontInfo{constructor(opts,isTrusted){super(opts),this._editorStylingBrand=void 0,this.version=1,this.isTrusted=isTrusted,this.isMonospace=opts.isMonospace,this.typicalHalfwidthCharacterWidth=opts.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=opts.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=opts.canUseHalfwidthRightwardsArrow,this.spaceWidth=opts.spaceWidth,this.middotWidth=opts.middotWidth,this.wsmiddotWidth=opts.wsmiddotWidth,this.maxDigitWidth=opts.maxDigitWidth}equals(other){return this.fontFamily===other.fontFamily&&this.fontWeight===other.fontWeight&&this.fontSize===other.fontSize&&this.fontFeatureSettings===other.fontFeatureSettings&&this.lineHeight===other.lineHeight&&this.letterSpacing===other.letterSpacing&&this.typicalHalfwidthCharacterWidth===other.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===other.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===other.canUseHalfwidthRightwardsArrow&&this.spaceWidth===other.spaceWidth&&this.middotWidth===other.middotWidth&&this.wsmiddotWidth===other.wsmiddotWidth&&this.maxDigitWidth===other.maxDigitWidth}}