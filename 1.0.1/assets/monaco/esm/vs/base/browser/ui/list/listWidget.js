var TypeNavigationControllerState,__decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};import{createStyleSheet}from"../../dom.js";import{DomEmitter,stopEvent}from"../../event.js";import{StandardKeyboardEvent}from"../../keyboardEvent.js";import{Gesture}from"../../touch.js";import{alert}from"../aria/aria.js";import{CombinedSpliceable}from"./splice.js";import{binarySearch,firstOrDefault,range}from"../../../common/arrays.js";import{timeout}from"../../../common/async.js";import{Color}from"../../../common/color.js";import{memoize}from"../../../common/decorators.js";import{Emitter,Event,EventBufferer}from"../../../common/event.js";import{matchesPrefix}from"../../../common/filters.js";import{DisposableStore,dispose}from"../../../common/lifecycle.js";import{clamp}from"../../../common/numbers.js";import{mixin}from"../../../common/objects.js";import*as platform from"../../../common/platform.js";import{isNumber}from"../../../common/types.js";import"./list.css";import{ListError}from"./list.js";import{ListView}from"./listView.js";class TraitRenderer{constructor(trait){this.trait=trait,this.renderedElements=[]}get templateId(){return`template:${this.trait.name}`}renderTemplate(container){return container}renderElement(element,index,templateData){const renderedElementIndex=this.renderedElements.findIndex((el=>el.templateData===templateData));if(renderedElementIndex>=0){const rendered=this.renderedElements[renderedElementIndex];this.trait.unrender(templateData),rendered.index=index}else{const rendered={index,templateData};this.renderedElements.push(rendered)}this.trait.renderIndex(index,templateData)}splice(start,deleteCount,insertCount){const rendered=[];for(const renderedElement of this.renderedElements)renderedElement.index<start?rendered.push(renderedElement):renderedElement.index>=start+deleteCount&&rendered.push({index:renderedElement.index+insertCount-deleteCount,templateData:renderedElement.templateData});this.renderedElements=rendered}renderIndexes(indexes){for(const{index,templateData}of this.renderedElements)indexes.indexOf(index)>-1&&this.trait.renderIndex(index,templateData)}disposeTemplate(templateData){const index=this.renderedElements.findIndex((el=>el.templateData===templateData));index<0||this.renderedElements.splice(index,1)}}class Trait{constructor(_trait){this._trait=_trait,this.length=0,this.indexes=[],this.sortedIndexes=[],this._onChange=new Emitter,this.onChange=this._onChange.event}get name(){return this._trait}get renderer(){return new TraitRenderer(this)}splice(start,deleteCount,elements){var _a;deleteCount=Math.max(0,Math.min(deleteCount,this.length-start));const diff=elements.length-deleteCount,end=start+deleteCount,sortedIndexes=[...this.sortedIndexes.filter((i=>i<start)),...elements.map(((hasTrait,i)=>hasTrait?i+start:-1)).filter((i=>-1!==i)),...this.sortedIndexes.filter((i=>i>=end)).map((i=>i+diff))],length=this.length+diff;if(this.sortedIndexes.length>0&&0===sortedIndexes.length&&length>0){const first=null!==(_a=this.sortedIndexes.find((index=>index>=start)))&&void 0!==_a?_a:length-1;sortedIndexes.push(Math.min(first,length-1))}this.renderer.splice(start,deleteCount,elements.length),this._set(sortedIndexes,sortedIndexes),this.length=length}renderIndex(index,container){container.classList.toggle(this._trait,this.contains(index))}unrender(container){container.classList.remove(this._trait)}set(indexes,browserEvent){return this._set(indexes,[...indexes].sort(numericSort),browserEvent)}_set(indexes,sortedIndexes,browserEvent){const result=this.indexes,sortedResult=this.sortedIndexes;this.indexes=indexes,this.sortedIndexes=sortedIndexes;const toRender=disjunction(sortedResult,indexes);return this.renderer.renderIndexes(toRender),this._onChange.fire({indexes,browserEvent}),result}get(){return this.indexes}contains(index){return binarySearch(this.sortedIndexes,index,numericSort)>=0}dispose(){dispose(this._onChange)}}__decorate([memoize],Trait.prototype,"renderer",null);class SelectionTrait extends Trait{constructor(setAriaSelected){super("selected"),this.setAriaSelected=setAriaSelected}renderIndex(index,container){super.renderIndex(index,container),this.setAriaSelected&&(this.contains(index)?container.setAttribute("aria-selected","true"):container.setAttribute("aria-selected","false"))}}class TraitSpliceable{constructor(trait,view,identityProvider){this.trait=trait,this.view=view,this.identityProvider=identityProvider}splice(start,deleteCount,elements){if(!this.identityProvider)return this.trait.splice(start,deleteCount,elements.map((()=>!1)));const pastElementsWithTrait=this.trait.get().map((i=>this.identityProvider.getId(this.view.element(i)).toString())),elementsWithTrait=elements.map((e=>pastElementsWithTrait.indexOf(this.identityProvider.getId(e).toString())>-1));this.trait.splice(start,deleteCount,elementsWithTrait)}}export function isInputElement(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}export function isMonacoEditor(e){return!!e.classList.contains("monaco-editor")||!e.classList.contains("monaco-list")&&(!!e.parentElement&&isMonacoEditor(e.parentElement))}export function isButton(e){return!!("A"===e.tagName&&e.classList.contains("monaco-button")||"DIV"===e.tagName&&e.classList.contains("monaco-button-dropdown"))||!e.classList.contains("monaco-list")&&(!!e.parentElement&&isButton(e.parentElement))}class KeyboardController{constructor(list,view,options){this.list=list,this.view=view,this.disposables=new DisposableStore,this.multipleSelectionDisposables=new DisposableStore,this.onKeyDown.filter((e=>3===e.keyCode)).on(this.onEnter,this,this.disposables),this.onKeyDown.filter((e=>16===e.keyCode)).on(this.onUpArrow,this,this.disposables),this.onKeyDown.filter((e=>18===e.keyCode)).on(this.onDownArrow,this,this.disposables),this.onKeyDown.filter((e=>11===e.keyCode)).on(this.onPageUpArrow,this,this.disposables),this.onKeyDown.filter((e=>12===e.keyCode)).on(this.onPageDownArrow,this,this.disposables),this.onKeyDown.filter((e=>9===e.keyCode)).on(this.onEscape,this,this.disposables),!1!==options.multipleSelectionSupport&&this.onKeyDown.filter((e=>(platform.isMacintosh?e.metaKey:e.ctrlKey)&&31===e.keyCode)).on(this.onCtrlA,this,this.multipleSelectionDisposables)}get onKeyDown(){return this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event).filter((e=>!isInputElement(e.target))).map((e=>new StandardKeyboardEvent(e))))}updateOptions(optionsUpdate){void 0!==optionsUpdate.multipleSelectionSupport&&(this.multipleSelectionDisposables.clear(),optionsUpdate.multipleSelectionSupport&&this.onKeyDown.filter((e=>(platform.isMacintosh?e.metaKey:e.ctrlKey)&&31===e.keyCode)).on(this.onCtrlA,this,this.multipleSelectionDisposables))}onEnter(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(this.list.getFocus(),e.browserEvent)}onUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPrevious(1,!1,e.browserEvent);const el=this.list.getFocus()[0];this.list.setAnchor(el),this.list.reveal(el),this.view.domNode.focus()}onDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNext(1,!1,e.browserEvent);const el=this.list.getFocus()[0];this.list.setAnchor(el),this.list.reveal(el),this.view.domNode.focus()}onPageUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPreviousPage(e.browserEvent);const el=this.list.getFocus()[0];this.list.setAnchor(el),this.list.reveal(el),this.view.domNode.focus()}onPageDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNextPage(e.browserEvent);const el=this.list.getFocus()[0];this.list.setAnchor(el),this.list.reveal(el),this.view.domNode.focus()}onCtrlA(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(range(this.list.length),e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus()}onEscape(e){this.list.getSelection().length&&(e.preventDefault(),e.stopPropagation(),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus())}dispose(){this.disposables.dispose(),this.multipleSelectionDisposables.dispose()}}__decorate([memoize],KeyboardController.prototype,"onKeyDown",null);export var TypeNavigationMode;!function(TypeNavigationMode){TypeNavigationMode[TypeNavigationMode.Automatic=0]="Automatic",TypeNavigationMode[TypeNavigationMode.Trigger=1]="Trigger"}(TypeNavigationMode||(TypeNavigationMode={})),function(TypeNavigationControllerState){TypeNavigationControllerState[TypeNavigationControllerState.Idle=0]="Idle",TypeNavigationControllerState[TypeNavigationControllerState.Typing=1]="Typing"}(TypeNavigationControllerState||(TypeNavigationControllerState={}));export const DefaultKeyboardNavigationDelegate=new class{mightProducePrintableCharacter(event){return!(event.ctrlKey||event.metaKey||event.altKey)&&(event.keyCode>=31&&event.keyCode<=56||event.keyCode>=21&&event.keyCode<=30||event.keyCode>=93&&event.keyCode<=102||event.keyCode>=80&&event.keyCode<=90)}};class TypeNavigationController{constructor(list,view,keyboardNavigationLabelProvider,keyboardNavigationEventFilter,delegate){this.list=list,this.view=view,this.keyboardNavigationLabelProvider=keyboardNavigationLabelProvider,this.keyboardNavigationEventFilter=keyboardNavigationEventFilter,this.delegate=delegate,this.enabled=!1,this.state=TypeNavigationControllerState.Idle,this.mode=TypeNavigationMode.Automatic,this.triggered=!1,this.previouslyFocused=-1,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this.updateOptions(list.options)}updateOptions(options){var _a,_b;null===(_a=options.typeNavigationEnabled)||void 0===_a||_a?this.enable():this.disable(),this.mode=null!==(_b=options.typeNavigationMode)&&void 0!==_b?_b:TypeNavigationMode.Automatic}enable(){if(this.enabled)return;let typing=!1;const onChar=this.enabledDisposables.add(Event.chain(this.enabledDisposables.add(new DomEmitter(this.view.domNode,"keydown")).event)).filter((e=>!isInputElement(e.target))).filter((()=>this.mode===TypeNavigationMode.Automatic||this.triggered)).map((event=>new StandardKeyboardEvent(event))).filter((e=>typing||this.keyboardNavigationEventFilter(e))).filter((e=>this.delegate.mightProducePrintableCharacter(e))).forEach(stopEvent).map((event=>event.browserEvent.key)).event,onClear=Event.debounce(onChar,(()=>null),800,void 0,void 0,this.enabledDisposables);Event.reduce(Event.any(onChar,onClear),((r,i)=>null===i?null:(r||"")+i),void 0,this.enabledDisposables)(this.onInput,this,this.enabledDisposables),onClear(this.onClear,this,this.enabledDisposables),onChar((()=>typing=!0),void 0,this.enabledDisposables),onClear((()=>typing=!1),void 0,this.enabledDisposables),this.enabled=!0,this.triggered=!1}disable(){this.enabled&&(this.enabledDisposables.clear(),this.enabled=!1,this.triggered=!1)}onClear(){var _a;const focus=this.list.getFocus();if(focus.length>0&&focus[0]===this.previouslyFocused){const ariaLabel=null===(_a=this.list.options.accessibilityProvider)||void 0===_a?void 0:_a.getAriaLabel(this.list.element(focus[0]));ariaLabel&&alert(ariaLabel)}this.previouslyFocused=-1}onInput(word){if(!word)return this.state=TypeNavigationControllerState.Idle,void(this.triggered=!1);const focus=this.list.getFocus(),start=focus.length>0?focus[0]:0,delta=this.state===TypeNavigationControllerState.Idle?1:0;this.state=TypeNavigationControllerState.Typing;for(let i=0;i<this.list.length;i++){const index=(start+i+delta)%this.list.length,label=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(this.view.element(index)),labelStr=label&&label.toString();if(void 0===labelStr||matchesPrefix(word,labelStr))return this.previouslyFocused=start,this.list.setFocus([index]),void this.list.reveal(index)}}dispose(){this.disable(),this.enabledDisposables.dispose(),this.disposables.dispose()}}class DOMFocusController{constructor(list,view){this.list=list,this.view=view,this.disposables=new DisposableStore;this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(view.domNode,"keydown")).event)).filter((e=>!isInputElement(e.target))).map((e=>new StandardKeyboardEvent(e))).filter((e=>!(2!==e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey))).on(this.onTab,this,this.disposables)}onTab(e){if(e.target!==this.view.domNode)return;const focus=this.list.getFocus();if(0===focus.length)return;const focusedDomElement=this.view.domElement(focus[0]);if(!focusedDomElement)return;const tabIndexElement=focusedDomElement.querySelector("[tabIndex]");if(!(tabIndexElement&&tabIndexElement instanceof HTMLElement&&-1!==tabIndexElement.tabIndex))return;const style=window.getComputedStyle(tabIndexElement);"hidden"!==style.visibility&&"none"!==style.display&&(e.preventDefault(),e.stopPropagation(),tabIndexElement.focus())}dispose(){this.disposables.dispose()}}export function isSelectionSingleChangeEvent(event){return platform.isMacintosh?event.browserEvent.metaKey:event.browserEvent.ctrlKey}export function isSelectionRangeChangeEvent(event){return event.browserEvent.shiftKey}function isMouseRightClick(event){return event instanceof MouseEvent&&2===event.button}const DefaultMultipleSelectionController={isSelectionSingleChangeEvent,isSelectionRangeChangeEvent};export class MouseController{constructor(list){this.list=list,this.disposables=new DisposableStore,this._onPointer=new Emitter,this.onPointer=this._onPointer.event,!1!==list.options.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController),this.mouseSupport=void 0===list.options.mouseSupport||!!list.options.mouseSupport,this.mouseSupport&&(list.onMouseDown(this.onMouseDown,this,this.disposables),list.onContextMenu(this.onContextMenu,this,this.disposables),list.onMouseDblClick(this.onDoubleClick,this,this.disposables),list.onTouchStart(this.onMouseDown,this,this.disposables),this.disposables.add(Gesture.addTarget(list.getHTMLElement()))),Event.any(list.onMouseClick,list.onMouseMiddleClick,list.onTap)(this.onViewPointer,this,this.disposables)}updateOptions(optionsUpdate){void 0!==optionsUpdate.multipleSelectionSupport&&(this.multipleSelectionController=void 0,optionsUpdate.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController))}isSelectionSingleChangeEvent(event){return!!this.multipleSelectionController&&this.multipleSelectionController.isSelectionSingleChangeEvent(event)}isSelectionRangeChangeEvent(event){return!!this.multipleSelectionController&&this.multipleSelectionController.isSelectionRangeChangeEvent(event)}isSelectionChangeEvent(event){return this.isSelectionSingleChangeEvent(event)||this.isSelectionRangeChangeEvent(event)}onMouseDown(e){isMonacoEditor(e.browserEvent.target)||document.activeElement!==e.browserEvent.target&&this.list.domFocus()}onContextMenu(e){if(isMonacoEditor(e.browserEvent.target))return;const focus=void 0===e.index?[]:[e.index];this.list.setFocus(focus,e.browserEvent)}onViewPointer(e){if(!this.mouseSupport)return;if(isInputElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;const focus=e.index;return void 0===focus?(this.list.setFocus([],e.browserEvent),this.list.setSelection([],e.browserEvent),void this.list.setAnchor(void 0)):this.isSelectionRangeChangeEvent(e)||this.isSelectionChangeEvent(e)?this.changeSelection(e):(this.list.setFocus([focus],e.browserEvent),this.list.setAnchor(focus),isMouseRightClick(e.browserEvent)||this.list.setSelection([focus],e.browserEvent),void this._onPointer.fire(e))}onDoubleClick(e){if(isInputElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;if(this.isSelectionChangeEvent(e))return;const focus=this.list.getFocus();this.list.setSelection(focus,e.browserEvent)}changeSelection(e){const focus=e.index;let anchor=this.list.getAnchor();if(this.isSelectionRangeChangeEvent(e)){if(void 0===anchor){const currentFocus=this.list.getFocus()[0];anchor=null!=currentFocus?currentFocus:focus,this.list.setAnchor(anchor)}const min=Math.min(anchor,focus),max=Math.max(anchor,focus),rangeSelection=range(min,max+1),selection=this.list.getSelection(),contiguousRange=getContiguousRangeContaining(disjunction(selection,[anchor]),anchor);if(0===contiguousRange.length)return;const newSelection=disjunction(rangeSelection,relativeComplement(selection,contiguousRange));this.list.setSelection(newSelection,e.browserEvent),this.list.setFocus([focus],e.browserEvent)}else if(this.isSelectionSingleChangeEvent(e)){const selection=this.list.getSelection(),newSelection=selection.filter((i=>i!==focus));this.list.setFocus([focus]),this.list.setAnchor(focus),selection.length===newSelection.length?this.list.setSelection([...newSelection,focus],e.browserEvent):this.list.setSelection(newSelection,e.browserEvent)}}dispose(){this.disposables.dispose()}}export class DefaultStyleController{constructor(styleElement,selectorSuffix){this.styleElement=styleElement,this.selectorSuffix=selectorSuffix}style(styles){const suffix=this.selectorSuffix&&`.${this.selectorSuffix}`,content=[];styles.listBackground&&(styles.listBackground.isOpaque()?content.push(`.monaco-list${suffix} .monaco-list-rows { background: ${styles.listBackground}; }`):platform.isMacintosh||console.warn(`List with id '${this.selectorSuffix}' was styled with a non-opaque background color. This will break sub-pixel antialiasing.`)),styles.listFocusBackground&&(content.push(`.monaco-list${suffix}:focus .monaco-list-row.focused { background-color: ${styles.listFocusBackground}; }`),content.push(`.monaco-list${suffix}:focus .monaco-list-row.focused:hover { background-color: ${styles.listFocusBackground}; }`)),styles.listFocusForeground&&content.push(`.monaco-list${suffix}:focus .monaco-list-row.focused { color: ${styles.listFocusForeground}; }`),styles.listActiveSelectionBackground&&(content.push(`.monaco-list${suffix}:focus .monaco-list-row.selected { background-color: ${styles.listActiveSelectionBackground}; }`),content.push(`.monaco-list${suffix}:focus .monaco-list-row.selected:hover { background-color: ${styles.listActiveSelectionBackground}; }`)),styles.listActiveSelectionForeground&&content.push(`.monaco-list${suffix}:focus .monaco-list-row.selected { color: ${styles.listActiveSelectionForeground}; }`),styles.listActiveSelectionIconForeground&&content.push(`.monaco-list${suffix}:focus .monaco-list-row.selected .codicon { color: ${styles.listActiveSelectionIconForeground}; }`),styles.listFocusAndSelectionOutline&&content.push(`.monaco-list${suffix}:focus .monaco-list-row.selected { outline-color: ${styles.listFocusAndSelectionOutline} !important; }`),styles.listFocusAndSelectionBackground&&content.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${suffix}:focus .monaco-list-row.selected.focused { background-color: ${styles.listFocusAndSelectionBackground}; }\n\t\t\t`),styles.listFocusAndSelectionForeground&&content.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${suffix}:focus .monaco-list-row.selected.focused { color: ${styles.listFocusAndSelectionForeground}; }\n\t\t\t`),styles.listInactiveFocusForeground&&(content.push(`.monaco-list${suffix} .monaco-list-row.focused { color:  ${styles.listInactiveFocusForeground}; }`),content.push(`.monaco-list${suffix} .monaco-list-row.focused:hover { color:  ${styles.listInactiveFocusForeground}; }`)),styles.listInactiveSelectionIconForeground&&content.push(`.monaco-list${suffix} .monaco-list-row.focused .codicon { color:  ${styles.listInactiveSelectionIconForeground}; }`),styles.listInactiveFocusBackground&&(content.push(`.monaco-list${suffix} .monaco-list-row.focused { background-color:  ${styles.listInactiveFocusBackground}; }`),content.push(`.monaco-list${suffix} .monaco-list-row.focused:hover { background-color:  ${styles.listInactiveFocusBackground}; }`)),styles.listInactiveSelectionBackground&&(content.push(`.monaco-list${suffix} .monaco-list-row.selected { background-color:  ${styles.listInactiveSelectionBackground}; }`),content.push(`.monaco-list${suffix} .monaco-list-row.selected:hover { background-color:  ${styles.listInactiveSelectionBackground}; }`)),styles.listInactiveSelectionForeground&&content.push(`.monaco-list${suffix} .monaco-list-row.selected { color: ${styles.listInactiveSelectionForeground}; }`),styles.listHoverBackground&&content.push(`.monaco-list${suffix}:not(.drop-target) .monaco-list-row:hover:not(.selected):not(.focused) { background-color: ${styles.listHoverBackground}; }`),styles.listHoverForeground&&content.push(`.monaco-list${suffix} .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${styles.listHoverForeground}; }`),styles.listSelectionOutline&&content.push(`.monaco-list${suffix} .monaco-list-row.selected { outline: 1px dotted ${styles.listSelectionOutline}; outline-offset: -1px; }`),styles.listFocusOutline&&content.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${suffix}:focus .monaco-list-row.focused { outline: 1px solid ${styles.listFocusOutline}; outline-offset: -1px; }\n\t\t\t\t.monaco-workbench.context-menu-visible .monaco-list${suffix}.last-focused .monaco-list-row.focused { outline: 1px solid ${styles.listFocusOutline}; outline-offset: -1px; }\n\t\t\t`),styles.listInactiveFocusOutline&&content.push(`.monaco-list${suffix} .monaco-list-row.focused { outline: 1px dotted ${styles.listInactiveFocusOutline}; outline-offset: -1px; }`),styles.listHoverOutline&&content.push(`.monaco-list${suffix} .monaco-list-row:hover { outline: 1px dashed ${styles.listHoverOutline}; outline-offset: -1px; }`),styles.listDropBackground&&content.push(`\n\t\t\t\t.monaco-list${suffix}.drop-target,\n\t\t\t\t.monaco-list${suffix} .monaco-list-rows.drop-target,\n\t\t\t\t.monaco-list${suffix} .monaco-list-row.drop-target { background-color: ${styles.listDropBackground} !important; color: inherit !important; }\n\t\t\t`),styles.tableColumnsBorder&&content.push(`\n\t\t\t\t.monaco-table:hover > .monaco-split-view2,\n\t\t\t\t.monaco-table:hover > .monaco-split-view2 .monaco-sash.vertical::before {\n\t\t\t\t\tborder-color: ${styles.tableColumnsBorder};\n\t\t\t}`),styles.tableOddRowsBackgroundColor&&content.push(`\n\t\t\t\t.monaco-table .monaco-list-row[data-parity=odd]:not(.focused):not(.selected):not(:hover) .monaco-table-tr,\n\t\t\t\t.monaco-table .monaco-list:not(:focus) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr,\n\t\t\t\t.monaco-table .monaco-list:not(.focused) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr {\n\t\t\t\t\tbackground-color: ${styles.tableOddRowsBackgroundColor};\n\t\t\t\t}\n\t\t\t`),this.styleElement.textContent=content.join("\n")}}const defaultStyles={listFocusBackground:Color.fromHex("#7FB0D0"),listActiveSelectionBackground:Color.fromHex("#0E639C"),listActiveSelectionForeground:Color.fromHex("#FFFFFF"),listActiveSelectionIconForeground:Color.fromHex("#FFFFFF"),listFocusAndSelectionOutline:Color.fromHex("#90C2F9"),listFocusAndSelectionBackground:Color.fromHex("#094771"),listFocusAndSelectionForeground:Color.fromHex("#FFFFFF"),listInactiveSelectionBackground:Color.fromHex("#3F3F46"),listInactiveSelectionIconForeground:Color.fromHex("#FFFFFF"),listHoverBackground:Color.fromHex("#2A2D2E"),listDropBackground:Color.fromHex("#383B3D"),treeIndentGuidesStroke:Color.fromHex("#a9a9a9"),tableColumnsBorder:Color.fromHex("#cccccc").transparent(.2),tableOddRowsBackgroundColor:Color.fromHex("#cccccc").transparent(.04)},DefaultOptions={keyboardSupport:!0,mouseSupport:!0,multipleSelectionSupport:!0,dnd:{getDragURI:()=>null,onDragStart(){},onDragOver:()=>!1,drop(){}}};function getContiguousRangeContaining(range,value){const index=range.indexOf(value);if(-1===index)return[];const result=[];let i=index-1;for(;i>=0&&range[i]===value-(index-i);)result.push(range[i--]);for(result.reverse(),i=index;i<range.length&&range[i]===value+(i-index);)result.push(range[i++]);return result}function disjunction(one,other){const result=[];let i=0,j=0;for(;i<one.length||j<other.length;)if(i>=one.length)result.push(other[j++]);else if(j>=other.length)result.push(one[i++]);else{if(one[i]===other[j]){result.push(one[i]),i++,j++;continue}one[i]<other[j]?result.push(one[i++]):result.push(other[j++])}return result}function relativeComplement(one,other){const result=[];let i=0,j=0;for(;i<one.length||j<other.length;)if(i>=one.length)result.push(other[j++]);else if(j>=other.length)result.push(one[i++]);else{if(one[i]===other[j]){i++,j++;continue}one[i]<other[j]?result.push(one[i++]):j++}return result}const numericSort=(a,b)=>a-b;class PipelineRenderer{constructor(_templateId,renderers){this._templateId=_templateId,this.renderers=renderers}get templateId(){return this._templateId}renderTemplate(container){return this.renderers.map((r=>r.renderTemplate(container)))}renderElement(element,index,templateData,height){let i=0;for(const renderer of this.renderers)renderer.renderElement(element,index,templateData[i++],height)}disposeElement(element,index,templateData,height){var _a;let i=0;for(const renderer of this.renderers)null===(_a=renderer.disposeElement)||void 0===_a||_a.call(renderer,element,index,templateData[i],height),i+=1}disposeTemplate(templateData){let i=0;for(const renderer of this.renderers)renderer.disposeTemplate(templateData[i++])}}class AccessibiltyRenderer{constructor(accessibilityProvider){this.accessibilityProvider=accessibilityProvider,this.templateId="a18n"}renderTemplate(container){return container}renderElement(element,index,container){const ariaLabel=this.accessibilityProvider.getAriaLabel(element);ariaLabel?container.setAttribute("aria-label",ariaLabel):container.removeAttribute("aria-label");const ariaLevel=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(element);"number"==typeof ariaLevel?container.setAttribute("aria-level",`${ariaLevel}`):container.removeAttribute("aria-level")}disposeTemplate(templateData){}}class ListViewDragAndDrop{constructor(list,dnd){this.list=list,this.dnd=dnd}getDragElements(element){const selection=this.list.getSelectedElements();return selection.indexOf(element)>-1?selection:[element]}getDragURI(element){return this.dnd.getDragURI(element)}getDragLabel(elements,originalEvent){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(elements,originalEvent)}onDragStart(data,originalEvent){var _a,_b;null===(_b=(_a=this.dnd).onDragStart)||void 0===_b||_b.call(_a,data,originalEvent)}onDragOver(data,targetElement,targetIndex,originalEvent){return this.dnd.onDragOver(data,targetElement,targetIndex,originalEvent)}onDragLeave(data,targetElement,targetIndex,originalEvent){var _a,_b;null===(_b=(_a=this.dnd).onDragLeave)||void 0===_b||_b.call(_a,data,targetElement,targetIndex,originalEvent)}onDragEnd(originalEvent){var _a,_b;null===(_b=(_a=this.dnd).onDragEnd)||void 0===_b||_b.call(_a,originalEvent)}drop(data,targetElement,targetIndex,originalEvent){this.dnd.drop(data,targetElement,targetIndex,originalEvent)}}export class List{constructor(user,container,virtualDelegate,renderers,_options=DefaultOptions){var _a,_b,_c,_d;this.user=user,this._options=_options,this.focus=new Trait("focused"),this.anchor=new Trait("anchor"),this.eventBufferer=new EventBufferer,this._ariaLabel="",this.disposables=new DisposableStore,this._onDidDispose=new Emitter,this.onDidDispose=this._onDidDispose.event;const role=this._options.accessibilityProvider&&this._options.accessibilityProvider.getWidgetRole?null===(_a=this._options.accessibilityProvider)||void 0===_a?void 0:_a.getWidgetRole():"list";this.selection=new SelectionTrait("listbox"!==role),mixin(_options,defaultStyles,!1);const baseRenderers=[this.focus.renderer,this.selection.renderer];this.accessibilityProvider=_options.accessibilityProvider,this.accessibilityProvider&&(baseRenderers.push(new AccessibiltyRenderer(this.accessibilityProvider)),null===(_c=(_b=this.accessibilityProvider).onDidChangeActiveDescendant)||void 0===_c||_c.call(_b,this.onDidChangeActiveDescendant,this,this.disposables)),renderers=renderers.map((r=>new PipelineRenderer(r.templateId,[...baseRenderers,r])));const viewOptions=Object.assign(Object.assign({},_options),{dnd:_options.dnd&&new ListViewDragAndDrop(this,_options.dnd)});if(this.view=new ListView(container,virtualDelegate,renderers,viewOptions),this.view.domNode.setAttribute("role",role),_options.styleController)this.styleController=_options.styleController(this.view.domId);else{const styleElement=createStyleSheet(this.view.domNode);this.styleController=new DefaultStyleController(styleElement,this.view.domId)}if(this.spliceable=new CombinedSpliceable([new TraitSpliceable(this.focus,this.view,_options.identityProvider),new TraitSpliceable(this.selection,this.view,_options.identityProvider),new TraitSpliceable(this.anchor,this.view,_options.identityProvider),this.view]),this.disposables.add(this.focus),this.disposables.add(this.selection),this.disposables.add(this.anchor),this.disposables.add(this.view),this.disposables.add(this._onDidDispose),this.disposables.add(new DOMFocusController(this,this.view)),("boolean"!=typeof _options.keyboardSupport||_options.keyboardSupport)&&(this.keyboardController=new KeyboardController(this,this.view,_options),this.disposables.add(this.keyboardController)),_options.keyboardNavigationLabelProvider){const delegate=_options.keyboardNavigationDelegate||DefaultKeyboardNavigationDelegate;this.typeNavigationController=new TypeNavigationController(this,this.view,_options.keyboardNavigationLabelProvider,null!==(_d=_options.keyboardNavigationEventFilter)&&void 0!==_d?_d:()=>!0,delegate),this.disposables.add(this.typeNavigationController)}this.mouseController=this.createMouseController(_options),this.disposables.add(this.mouseController),this.onDidChangeFocus(this._onFocusChange,this,this.disposables),this.onDidChangeSelection(this._onSelectionChange,this,this.disposables),this.accessibilityProvider&&(this.ariaLabel=this.accessibilityProvider.getWidgetAriaLabel()),!1!==this._options.multipleSelectionSupport&&this.view.domNode.setAttribute("aria-multiselectable","true")}get onDidChangeFocus(){return Event.map(this.eventBufferer.wrapEvent(this.focus.onChange),(e=>this.toListEvent(e)),this.disposables)}get onDidChangeSelection(){return Event.map(this.eventBufferer.wrapEvent(this.selection.onChange),(e=>this.toListEvent(e)),this.disposables)}get domId(){return this.view.domId}get onMouseClick(){return this.view.onMouseClick}get onMouseDblClick(){return this.view.onMouseDblClick}get onMouseMiddleClick(){return this.view.onMouseMiddleClick}get onPointer(){return this.mouseController.onPointer}get onMouseDown(){return this.view.onMouseDown}get onMouseOver(){return this.view.onMouseOver}get onTouchStart(){return this.view.onTouchStart}get onTap(){return this.view.onTap}get onContextMenu(){let didJustPressContextMenuKey=!1;const fromKeyDown=this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event)).map((e=>new StandardKeyboardEvent(e))).filter((e=>didJustPressContextMenuKey=58===e.keyCode||e.shiftKey&&68===e.keyCode)).map(stopEvent).filter((()=>!1)).event,fromKeyUp=this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keyup")).event)).forEach((()=>didJustPressContextMenuKey=!1)).map((e=>new StandardKeyboardEvent(e))).filter((e=>58===e.keyCode||e.shiftKey&&68===e.keyCode)).map(stopEvent).map((({browserEvent})=>{const focus=this.getFocus(),index=focus.length?focus[0]:void 0;return{index,element:void 0!==index?this.view.element(index):void 0,anchor:void 0!==index?this.view.domElement(index):this.view.domNode,browserEvent}})).event,fromMouse=this.disposables.add(Event.chain(this.view.onContextMenu)).filter((_=>!didJustPressContextMenuKey)).map((({element,index,browserEvent})=>({element,index,anchor:{x:browserEvent.pageX+1,y:browserEvent.pageY},browserEvent}))).event;return Event.any(fromKeyDown,fromKeyUp,fromMouse)}get onKeyDown(){return this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event}get onDidFocus(){return Event.signal(this.disposables.add(new DomEmitter(this.view.domNode,"focus",!0)).event)}createMouseController(options){return new MouseController(this)}updateOptions(optionsUpdate={}){var _a,_b;this._options=Object.assign(Object.assign({},this._options),optionsUpdate),null===(_a=this.typeNavigationController)||void 0===_a||_a.updateOptions(this._options),void 0!==this._options.multipleSelectionController&&(this._options.multipleSelectionSupport?this.view.domNode.setAttribute("aria-multiselectable","true"):this.view.domNode.removeAttribute("aria-multiselectable")),this.mouseController.updateOptions(optionsUpdate),null===(_b=this.keyboardController)||void 0===_b||_b.updateOptions(optionsUpdate),this.view.updateOptions(optionsUpdate)}get options(){return this._options}splice(start,deleteCount,elements=[]){if(start<0||start>this.view.length)throw new ListError(this.user,`Invalid start index: ${start}`);if(deleteCount<0)throw new ListError(this.user,`Invalid delete count: ${deleteCount}`);0===deleteCount&&0===elements.length||this.eventBufferer.bufferEvents((()=>this.spliceable.splice(start,deleteCount,elements)))}rerender(){this.view.rerender()}element(index){return this.view.element(index)}get length(){return this.view.length}get contentHeight(){return this.view.contentHeight}get scrollTop(){return this.view.getScrollTop()}set scrollTop(scrollTop){this.view.setScrollTop(scrollTop)}get ariaLabel(){return this._ariaLabel}set ariaLabel(value){this._ariaLabel=value,this.view.domNode.setAttribute("aria-label",value)}domFocus(){this.view.domNode.focus({preventScroll:!0})}layout(height,width){this.view.layout(height,width)}setSelection(indexes,browserEvent){for(const index of indexes)if(index<0||index>=this.length)throw new ListError(this.user,`Invalid index ${index}`);this.selection.set(indexes,browserEvent)}getSelection(){return this.selection.get()}getSelectedElements(){return this.getSelection().map((i=>this.view.element(i)))}setAnchor(index){if(void 0!==index){if(index<0||index>=this.length)throw new ListError(this.user,`Invalid index ${index}`);this.anchor.set([index])}else this.anchor.set([])}getAnchor(){return firstOrDefault(this.anchor.get(),void 0)}getAnchorElement(){const anchor=this.getAnchor();return void 0===anchor?void 0:this.element(anchor)}setFocus(indexes,browserEvent){for(const index of indexes)if(index<0||index>=this.length)throw new ListError(this.user,`Invalid index ${index}`);this.focus.set(indexes,browserEvent)}focusNext(n=1,loop=!1,browserEvent,filter){if(0===this.length)return;const focus=this.focus.get(),index=this.findNextIndex(focus.length>0?focus[0]+n:0,loop,filter);index>-1&&this.setFocus([index],browserEvent)}focusPrevious(n=1,loop=!1,browserEvent,filter){if(0===this.length)return;const focus=this.focus.get(),index=this.findPreviousIndex(focus.length>0?focus[0]-n:0,loop,filter);index>-1&&this.setFocus([index],browserEvent)}focusNextPage(browserEvent,filter){return __awaiter(this,void 0,void 0,(function*(){let lastPageIndex=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);lastPageIndex=0===lastPageIndex?0:lastPageIndex-1;const currentlyFocusedElementIndex=this.getFocus()[0];if(currentlyFocusedElementIndex!==lastPageIndex&&(void 0===currentlyFocusedElementIndex||lastPageIndex>currentlyFocusedElementIndex)){const lastGoodPageIndex=this.findPreviousIndex(lastPageIndex,!1,filter);lastGoodPageIndex>-1&&currentlyFocusedElementIndex!==lastGoodPageIndex?this.setFocus([lastGoodPageIndex],browserEvent):this.setFocus([lastPageIndex],browserEvent)}else{const previousScrollTop=this.view.getScrollTop();let nextpageScrollTop=previousScrollTop+this.view.renderHeight;lastPageIndex>currentlyFocusedElementIndex&&(nextpageScrollTop-=this.view.elementHeight(lastPageIndex)),this.view.setScrollTop(nextpageScrollTop),this.view.getScrollTop()!==previousScrollTop&&(this.setFocus([]),yield timeout(0),yield this.focusNextPage(browserEvent,filter))}}))}focusPreviousPage(browserEvent,filter){return __awaiter(this,void 0,void 0,(function*(){let firstPageIndex;const scrollTop=this.view.getScrollTop();firstPageIndex=0===scrollTop?this.view.indexAt(scrollTop):this.view.indexAfter(scrollTop-1);const currentlyFocusedElementIndex=this.getFocus()[0];if(currentlyFocusedElementIndex!==firstPageIndex&&(void 0===currentlyFocusedElementIndex||currentlyFocusedElementIndex>=firstPageIndex)){const firstGoodPageIndex=this.findNextIndex(firstPageIndex,!1,filter);firstGoodPageIndex>-1&&currentlyFocusedElementIndex!==firstGoodPageIndex?this.setFocus([firstGoodPageIndex],browserEvent):this.setFocus([firstPageIndex],browserEvent)}else{const previousScrollTop=scrollTop;this.view.setScrollTop(scrollTop-this.view.renderHeight),this.view.getScrollTop()!==previousScrollTop&&(this.setFocus([]),yield timeout(0),yield this.focusPreviousPage(browserEvent,filter))}}))}focusLast(browserEvent,filter){if(0===this.length)return;const index=this.findPreviousIndex(this.length-1,!1,filter);index>-1&&this.setFocus([index],browserEvent)}focusFirst(browserEvent,filter){this.focusNth(0,browserEvent,filter)}focusNth(n,browserEvent,filter){if(0===this.length)return;const index=this.findNextIndex(n,!1,filter);index>-1&&this.setFocus([index],browserEvent)}findNextIndex(index,loop=!1,filter){for(let i=0;i<this.length;i++){if(index>=this.length&&!loop)return-1;if(index%=this.length,!filter||filter(this.element(index)))return index;index++}return-1}findPreviousIndex(index,loop=!1,filter){for(let i=0;i<this.length;i++){if(index<0&&!loop)return-1;if(index=(this.length+index%this.length)%this.length,!filter||filter(this.element(index)))return index;index--}return-1}getFocus(){return this.focus.get()}getFocusedElements(){return this.getFocus().map((i=>this.view.element(i)))}reveal(index,relativeTop){if(index<0||index>=this.length)throw new ListError(this.user,`Invalid index ${index}`);const scrollTop=this.view.getScrollTop(),elementTop=this.view.elementTop(index),elementHeight=this.view.elementHeight(index);if(isNumber(relativeTop)){const m=elementHeight-this.view.renderHeight;this.view.setScrollTop(m*clamp(relativeTop,0,1)+elementTop)}else{const viewItemBottom=elementTop+elementHeight,scrollBottom=scrollTop+this.view.renderHeight;elementTop<scrollTop&&viewItemBottom>=scrollBottom||(elementTop<scrollTop||viewItemBottom>=scrollBottom&&elementHeight>=this.view.renderHeight?this.view.setScrollTop(elementTop):viewItemBottom>=scrollBottom&&this.view.setScrollTop(viewItemBottom-this.view.renderHeight))}}getHTMLElement(){return this.view.domNode}getElementID(index){return this.view.getElementDomId(index)}style(styles){this.styleController.style(styles)}toListEvent({indexes,browserEvent}){return{indexes,elements:indexes.map((i=>this.view.element(i))),browserEvent}}_onFocusChange(){const focus=this.focus.get();this.view.domNode.classList.toggle("element-focused",focus.length>0),this.onDidChangeActiveDescendant()}onDidChangeActiveDescendant(){var _a;const focus=this.focus.get();if(focus.length>0){let id;(null===(_a=this.accessibilityProvider)||void 0===_a?void 0:_a.getActiveDescendantId)&&(id=this.accessibilityProvider.getActiveDescendantId(this.view.element(focus[0]))),this.view.domNode.setAttribute("aria-activedescendant",id||this.view.getElementDomId(focus[0]))}else this.view.domNode.removeAttribute("aria-activedescendant")}_onSelectionChange(){const selection=this.selection.get();this.view.domNode.classList.toggle("selection-none",0===selection.length),this.view.domNode.classList.toggle("selection-single",1===selection.length),this.view.domNode.classList.toggle("selection-multiple",selection.length>1)}dispose(){this._onDidDispose.fire(),this.disposables.dispose(),this._onDidDispose.dispose()}}__decorate([memoize],List.prototype,"onDidChangeFocus",null),__decorate([memoize],List.prototype,"onDidChangeSelection",null),__decorate([memoize],List.prototype,"onContextMenu",null),__decorate([memoize],List.prototype,"onKeyDown",null),__decorate([memoize],List.prototype,"onDidFocus",null);