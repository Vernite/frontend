var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};import*as dom from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/codicons/codiconStyles.js";import{List}from"../../../../base/browser/ui/list/listWidget.js";import{createCancelablePromise,disposableTimeout,TimeoutTimer}from"../../../../base/common/async.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{Emitter}from"../../../../base/common/event.js";import{DisposableStore}from"../../../../base/common/lifecycle.js";import{clamp}from"../../../../base/common/numbers.js";import*as strings from"../../../../base/common/strings.js";import"./media/suggest.css";import{EmbeddedCodeEditorWidget}from"../../../browser/widget/embeddedCodeEditorWidget.js";import{SuggestWidgetStatus}from"./suggestWidgetStatus.js";import"../../symbolIcons/browser/symbolIcons.js";import*as nls from"../../../../nls.js";import{IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService}from"../../../../platform/storage/common/storage.js";import{activeContrastBorder,editorForeground,editorWidgetBackground,editorWidgetBorder,listFocusHighlightForeground,listHighlightForeground,quickInputListFocusBackground,quickInputListFocusForeground,quickInputListFocusIconForeground,registerColor,transparent}from"../../../../platform/theme/common/colorRegistry.js";import{attachListStyler}from"../../../../platform/theme/common/styler.js";import{isHighContrast}from"../../../../platform/theme/common/theme.js";import{IThemeService}from"../../../../platform/theme/common/themeService.js";import{ResizableHTMLElement}from"../../../../base/browser/ui/resizable/resizable.js";import{Context as SuggestContext}from"./suggest.js";import{canExpandCompletionItem,SuggestDetailsOverlay,SuggestDetailsWidget}from"./suggestWidgetDetails.js";import{getAriaId,ItemRenderer}from"./suggestWidgetRenderer.js";export const editorSuggestWidgetBackground=registerColor("editorSuggestWidget.background",{dark:editorWidgetBackground,light:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},nls.localize("editorSuggestWidgetBackground","Background color of the suggest widget."));export const editorSuggestWidgetBorder=registerColor("editorSuggestWidget.border",{dark:editorWidgetBorder,light:editorWidgetBorder,hcDark:editorWidgetBorder,hcLight:editorWidgetBorder},nls.localize("editorSuggestWidgetBorder","Border color of the suggest widget."));export const editorSuggestWidgetForeground=registerColor("editorSuggestWidget.foreground",{dark:editorForeground,light:editorForeground,hcDark:editorForeground,hcLight:editorForeground},nls.localize("editorSuggestWidgetForeground","Foreground color of the suggest widget."));export const editorSuggestWidgetSelectedForeground=registerColor("editorSuggestWidget.selectedForeground",{dark:quickInputListFocusForeground,light:quickInputListFocusForeground,hcDark:quickInputListFocusForeground,hcLight:quickInputListFocusForeground},nls.localize("editorSuggestWidgetSelectedForeground","Foreground color of the selected entry in the suggest widget."));export const editorSuggestWidgetSelectedIconForeground=registerColor("editorSuggestWidget.selectedIconForeground",{dark:quickInputListFocusIconForeground,light:quickInputListFocusIconForeground,hcDark:quickInputListFocusIconForeground,hcLight:quickInputListFocusIconForeground},nls.localize("editorSuggestWidgetSelectedIconForeground","Icon foreground color of the selected entry in the suggest widget."));export const editorSuggestWidgetSelectedBackground=registerColor("editorSuggestWidget.selectedBackground",{dark:quickInputListFocusBackground,light:quickInputListFocusBackground,hcDark:quickInputListFocusBackground,hcLight:quickInputListFocusBackground},nls.localize("editorSuggestWidgetSelectedBackground","Background color of the selected entry in the suggest widget."));export const editorSuggestWidgetHighlightForeground=registerColor("editorSuggestWidget.highlightForeground",{dark:listHighlightForeground,light:listHighlightForeground,hcDark:listHighlightForeground,hcLight:listHighlightForeground},nls.localize("editorSuggestWidgetHighlightForeground","Color of the match highlights in the suggest widget."));export const editorSuggestWidgetHighlightFocusForeground=registerColor("editorSuggestWidget.focusHighlightForeground",{dark:listFocusHighlightForeground,light:listFocusHighlightForeground,hcDark:listFocusHighlightForeground,hcLight:listFocusHighlightForeground},nls.localize("editorSuggestWidgetFocusHighlightForeground","Color of the match highlights in the suggest widget when an item is focused."));export const editorSuggestWidgetStatusForeground=registerColor("editorSuggestWidgetStatus.foreground",{dark:transparent(editorSuggestWidgetForeground,.5),light:transparent(editorSuggestWidgetForeground,.5),hcDark:transparent(editorSuggestWidgetForeground,.5),hcLight:transparent(editorSuggestWidgetForeground,.5)},nls.localize("editorSuggestWidgetStatusForeground","Foreground color of the suggest widget status."));class PersistedWidgetSize{constructor(_service,editor){this._service=_service,this._key=`suggestWidget.size/${editor.getEditorType()}/${editor instanceof EmbeddedCodeEditorWidget}`}restore(){var _a;const raw=null!==(_a=this._service.get(this._key,0))&&void 0!==_a?_a:"";try{const obj=JSON.parse(raw);if(dom.Dimension.is(obj))return dom.Dimension.lift(obj)}catch(_b){}}store(size){this._service.store(this._key,JSON.stringify(size),0,1)}reset(){this._service.remove(this._key,0)}}let SuggestWidget=class SuggestWidget{constructor(editor,_storageService,_contextKeyService,_themeService,instantiationService){this.editor=editor,this._storageService=_storageService,this._state=0,this._isAuto=!1,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new TimeoutTimer,this._disposables=new DisposableStore,this._onDidSelect=new Emitter,this._onDidFocus=new Emitter,this._onDidHide=new Emitter,this._onDidShow=new Emitter,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new Emitter,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new ResizableHTMLElement,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new SuggestContentWidget(this,editor),this._persistedSize=new PersistedWidgetSize(_storageService,editor);class ResizeState{constructor(persistedSize,currentSize,persistHeight=!1,persistWidth=!1){this.persistedSize=persistedSize,this.currentSize=currentSize,this.persistHeight=persistHeight,this.persistWidth=persistWidth}}let state;this._disposables.add(this.element.onDidWillResize((()=>{this._contentWidget.lockPreference(),state=new ResizeState(this._persistedSize.restore(),this.element.size)}))),this._disposables.add(this.element.onDidResize((e=>{var _a,_b,_c,_d;if(this._resize(e.dimension.width,e.dimension.height),state&&(state.persistHeight=state.persistHeight||!!e.north||!!e.south,state.persistWidth=state.persistWidth||!!e.east||!!e.west),e.done){if(state){const{itemHeight,defaultSize}=this.getLayoutInfo(),threshold=Math.round(itemHeight/2);let{width,height}=this.element.size;(!state.persistHeight||Math.abs(state.currentSize.height-height)<=threshold)&&(height=null!==(_b=null===(_a=state.persistedSize)||void 0===_a?void 0:_a.height)&&void 0!==_b?_b:defaultSize.height),(!state.persistWidth||Math.abs(state.currentSize.width-width)<=threshold)&&(width=null!==(_d=null===(_c=state.persistedSize)||void 0===_c?void 0:_c.width)&&void 0!==_d?_d:defaultSize.width),this._persistedSize.store(new dom.Dimension(width,height))}this._contentWidget.unlockPreference(),state=void 0}}))),this._messageElement=dom.append(this.element.domNode,dom.$(".message")),this._listElement=dom.append(this.element.domNode,dom.$(".tree"));const details=instantiationService.createInstance(SuggestDetailsWidget,this.editor);details.onDidClose(this.toggleDetails,this,this._disposables),this._details=new SuggestDetailsOverlay(details,this.editor);const applyIconStyle=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(108).showIcons);applyIconStyle();const renderer=instantiationService.createInstance(ItemRenderer,this.editor);this._disposables.add(renderer),this._disposables.add(renderer.onDidToggleDetails((()=>this.toggleDetails()))),this._list=new List("SuggestWidget",this._listElement,{getHeight:_element=>this.getLayoutInfo().itemHeight,getTemplateId:_element=>"suggestion"},[renderer],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>nls.localize("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:item=>{let label=item.textLabel;if("string"!=typeof item.completion.label){const{detail,description}=item.completion.label;detail&&description?label=nls.localize("label.full","{0}{1}, {2}",label,detail,description):detail?label=nls.localize("label.detail","{0}{1}",label,detail):description&&(label=nls.localize("label.desc","{0}, {1}",label,description))}if(!item.isResolved||!this._isDetailsVisible())return label;const{documentation,detail}=item.completion,docs=strings.format("{0}{1}",detail||"",documentation?"string"==typeof documentation?documentation:documentation.value:"");return nls.localize("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",label,docs)}}}),this._status=instantiationService.createInstance(SuggestWidgetStatus,this.element.domNode);const applyStatusBarStyle=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(108).showStatusBar);applyStatusBarStyle(),this._disposables.add(attachListStyler(this._list,_themeService,{listInactiveFocusBackground:editorSuggestWidgetSelectedBackground,listInactiveFocusOutline:activeContrastBorder})),this._disposables.add(_themeService.onDidColorThemeChange((t=>this._onThemeChange(t)))),this._onThemeChange(_themeService.getColorTheme()),this._disposables.add(this._list.onMouseDown((e=>this._onListMouseDownOrTap(e)))),this._disposables.add(this._list.onTap((e=>this._onListMouseDownOrTap(e)))),this._disposables.add(this._list.onDidChangeSelection((e=>this._onListSelection(e)))),this._disposables.add(this._list.onDidChangeFocus((e=>this._onListFocus(e)))),this._disposables.add(this.editor.onDidChangeCursorSelection((()=>this._onCursorSelectionChanged()))),this._disposables.add(this.editor.onDidChangeConfiguration((e=>{e.hasChanged(108)&&(applyStatusBarStyle(),applyIconStyle())}))),this._ctxSuggestWidgetVisible=SuggestContext.Visible.bindTo(_contextKeyService),this._ctxSuggestWidgetDetailsVisible=SuggestContext.DetailsVisible.bindTo(_contextKeyService),this._ctxSuggestWidgetMultipleSuggestions=SuggestContext.MultipleSuggestions.bindTo(_contextKeyService),this._ctxSuggestWidgetHasFocusedSuggestion=SuggestContext.HasFocusedSuggestion.bindTo(_contextKeyService),this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode,"keydown",(e=>{this._onDetailsKeydown.fire(e)}))),this._disposables.add(this.editor.onMouseDown((e=>this._onEditorMouseDown(e))))}dispose(){var _a;this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),null===(_a=this._loadingTimeout)||void 0===_a||_a.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(mouseEvent){this._details.widget.domNode.contains(mouseEvent.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(mouseEvent.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){0!==this._state&&this._contentWidget.layout()}_onListMouseDownOrTap(e){void 0!==e.element&&void 0!==e.index&&(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(item,index){const completionModel=this._completionModel;completionModel&&(this._onDidSelect.fire({item,index,model:completionModel}),this.editor.focus())}_onThemeChange(theme){this._details.widget.borderWidth=isHighContrast(theme.type)?2:1}_onListFocus(e){var _a;if(this._ignoreFocusEvents)return;if(!e.elements.length)return this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),void this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const item=e.elements[0],index=e.indexes[0];item!==this._focusedItem&&(null===(_a=this._currentSuggestionDetails)||void 0===_a||_a.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=item,this._list.reveal(index),this._currentSuggestionDetails=createCancelablePromise((token=>__awaiter(this,void 0,void 0,(function*(){const loading=disposableTimeout((()=>{this._isDetailsVisible()&&this.showDetails(!0)}),250),sub=token.onCancellationRequested((()=>loading.dispose())),result=yield item.resolve(token);return loading.dispose(),sub.dispose(),result})))),this._currentSuggestionDetails.then((()=>{index>=this._list.length||item!==this._list.element(index)||(this._ignoreFocusEvents=!0,this._list.splice(index,1,[item]),this._list.setFocus([index]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this.showDetails(!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:getAriaId(index)}))})).catch(onUnexpectedError)),this._onDidFocus.fire({item,index,model:this._completionModel})}_setState(state){if(this._state!==state)switch(this._state=state,this.element.domNode.classList.toggle("frozen",4===state),this.element.domNode.classList.remove("message"),state){case 0:dom.hide(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget.LOADING_MESSAGE,dom.hide(this._listElement,this._status.element),dom.show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0;break;case 2:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget.NO_SUGGESTIONS_MESSAGE,dom.hide(this._listElement,this._status.element),dom.show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0;break;case 3:case 4:dom.hide(this._messageElement),dom.show(this._listElement,this._status.element),this._show();break;case 5:dom.hide(this._messageElement),dom.show(this._listElement,this._status.element),this._details.show(),this._show()}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet((()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)}),100)}showTriggered(auto,delay){0===this._state&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!auto,this._isAuto||(this._loadingTimeout=disposableTimeout((()=>this._setState(1)),delay)))}showSuggestions(completionModel,selectionIndex,isFrozen,isAuto){var _a,_b;if(this._contentWidget.setPosition(this.editor.getPosition()),null===(_a=this._loadingTimeout)||void 0===_a||_a.dispose(),null===(_b=this._currentSuggestionDetails)||void 0===_b||_b.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==completionModel&&(this._completionModel=completionModel),isFrozen&&2!==this._state&&0!==this._state)return void this._setState(4);const visibleCount=this._completionModel.items.length,isEmpty=0===visibleCount;if(this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount>1),isEmpty)return this._setState(isAuto?0:2),void(this._completionModel=void 0);this._focusedItem=void 0,this._list.splice(0,this._list.length,this._completionModel.items),this._setState(isFrozen?4:3),selectionIndex>=0&&(this._list.reveal(selectionIndex,0),this._list.setFocus([selectionIndex])),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(0!==this._state&&2!==this._state&&1!==this._state&&this._completionModel)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){5===this._state?(this._setState(3),this._details.widget.domNode.classList.remove("focused")):3===this._state&&this._isDetailsVisible()&&(this._setState(5),this._details.widget.domNode.classList.add("focused"))}toggleDetails(){this._isDetailsVisible()?(this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):!canExpandCompletionItem(this._list.getFocusedElements()[0])&&!this._explainMode||3!==this._state&&5!==this._state&&4!==this._state||(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this.showDetails(!1))}showDetails(loading){this._details.show(),loading?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._positionDetails(),this.editor.focus(),this.element.domNode.classList.add("shows-details")}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this.showDetails(!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){var _a;null===(_a=this._loadingTimeout)||void 0===_a||_a.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();const dim=this._persistedSize.restore(),minPersistedHeight=Math.ceil(4.3*this.getLayoutInfo().itemHeight);dim&&dim.height<minPersistedHeight&&this._persistedSize.store(dim.with(void 0,minPersistedHeight))}isFrozen(){return 4===this._state}_afterRender(position){null!==position?2!==this._state&&1!==this._state&&(this._isDetailsVisible()&&this._details.show(),this._positionDetails()):this._isDetailsVisible()&&this._details.hide()}_layout(size){var _a,_b,_c;if(!this.editor.hasModel())return;if(!this.editor.getDomNode())return;const bodyBox=dom.getClientArea(document.body),info=this.getLayoutInfo();size||(size=info.defaultSize);let height=size.height,width=size.width;if(this._status.element.style.lineHeight=`${info.itemHeight}px`,2===this._state||1===this._state)height=info.itemHeight+info.borderHeight,width=info.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new dom.Dimension(width,height),this._contentWidget.setPreference(2);else{const maxWidth=bodyBox.width-info.borderHeight-2*info.horizontalPadding;width>maxWidth&&(width=maxWidth);const preferredWidth=this._completionModel?this._completionModel.stats.pLabelLen*info.typicalHalfwidthCharacterWidth:width,fullHeight=info.statusBarHeight+this._list.contentHeight+info.borderHeight,minHeight=info.itemHeight+info.statusBarHeight,editorBox=dom.getDomNodePagePosition(this.editor.getDomNode()),cursorBox=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),cursorBottom=editorBox.top+cursorBox.top+cursorBox.height,maxHeightBelow=Math.min(bodyBox.height-cursorBottom-info.verticalPadding,fullHeight),availableSpaceAbove=editorBox.top+cursorBox.top-info.verticalPadding,maxHeightAbove=Math.min(availableSpaceAbove,fullHeight);let maxHeight=Math.min(Math.max(maxHeightAbove,maxHeightBelow)+info.borderHeight,fullHeight);height===(null===(_a=this._cappedHeight)||void 0===_a?void 0:_a.capped)&&(height=this._cappedHeight.wanted),height<minHeight&&(height=minHeight),height>maxHeight&&(height=maxHeight);const forceRenderingAboveRequiredSpace=150;height>maxHeightBelow||this._forceRenderingAbove&&availableSpaceAbove>forceRenderingAboveRequiredSpace?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),maxHeight=maxHeightAbove):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),maxHeight=maxHeightBelow),this.element.preferredSize=new dom.Dimension(preferredWidth,info.defaultSize.height),this.element.maxSize=new dom.Dimension(maxWidth,maxHeight),this.element.minSize=new dom.Dimension(220,minHeight),this._cappedHeight=height===fullHeight?{wanted:null!==(_c=null===(_b=this._cappedHeight)||void 0===_b?void 0:_b.wanted)&&void 0!==_c?_c:size.height,capped:height}:void 0}this._resize(width,height)}_resize(width,height){const{width:maxWidth,height:maxHeight}=this.element.maxSize;width=Math.min(maxWidth,width),height=Math.min(maxHeight,height);const{statusBarHeight}=this.getLayoutInfo();this._list.layout(height-statusBarHeight,width),this._listElement.style.height=height-statusBarHeight+"px",this.element.layout(height,width),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){var _a;this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,2===(null===(_a=this._contentWidget.getPosition())||void 0===_a?void 0:_a.preference[0]))}getLayoutInfo(){const fontInfo=this.editor.getOption(46),itemHeight=clamp(this.editor.getOption(110)||fontInfo.lineHeight,8,1e3),statusBarHeight=this.editor.getOption(108).showStatusBar&&2!==this._state&&1!==this._state?itemHeight:0,borderWidth=this._details.widget.borderWidth,borderHeight=2*borderWidth;return{itemHeight,statusBarHeight,borderWidth,borderHeight,typicalHalfwidthCharacterWidth:fontInfo.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new dom.Dimension(430,statusBarHeight+12*itemHeight+borderHeight)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",0,!1)}_setDetailsVisible(value){this._storageService.store("expandSuggestionDocs",value,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};SuggestWidget.LOADING_MESSAGE=nls.localize("suggestWidget.loading","Loading..."),SuggestWidget.NO_SUGGESTIONS_MESSAGE=nls.localize("suggestWidget.noSuggestions","No suggestions."),SuggestWidget=__decorate([__param(1,IStorageService),__param(2,IContextKeyService),__param(3,IThemeService),__param(4,IInstantiationService)],SuggestWidget);export{SuggestWidget};export class SuggestContentWidget{constructor(_widget,_editor){this._widget=_widget,this._editor=_editor,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return!this._hidden&&this._position&&this._preference?{position:this._position,preference:[this._preference]}:null}beforeRender(){const{height,width}=this._widget.element.size,{borderWidth,horizontalPadding}=this._widget.getLayoutInfo();return new dom.Dimension(width+2*borderWidth+horizontalPadding,height+2*borderWidth)}afterRender(position){this._widget._afterRender(position)}setPreference(preference){this._preferenceLocked||(this._preference=preference)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(position){this._position=position}}