import{CursorColumns}from"../core/cursorColumns.js";export class AtomicTabMoveOperations{static whitespaceVisibleColumn(lineContent,position,tabSize){const lineLength=lineContent.length;let visibleColumn=0,prevTabStopPosition=-1,prevTabStopVisibleColumn=-1;for(let i=0;i<lineLength;i++){if(i===position)return[prevTabStopPosition,prevTabStopVisibleColumn,visibleColumn];visibleColumn%tabSize==0&&(prevTabStopPosition=i,prevTabStopVisibleColumn=visibleColumn);switch(lineContent.charCodeAt(i)){case 32:visibleColumn+=1;break;case 9:visibleColumn=CursorColumns.nextRenderTabStop(visibleColumn,tabSize);break;default:return[-1,-1,-1]}}return position===lineLength?[prevTabStopPosition,prevTabStopVisibleColumn,visibleColumn]:[-1,-1,-1]}static atomicPosition(lineContent,position,tabSize,direction){const lineLength=lineContent.length,[prevTabStopPosition,prevTabStopVisibleColumn,visibleColumn]=AtomicTabMoveOperations.whitespaceVisibleColumn(lineContent,position,tabSize);if(-1===visibleColumn)return-1;let left;switch(direction){case 0:left=!0;break;case 1:left=!1;break;case 2:if(visibleColumn%tabSize==0)return position;left=visibleColumn%tabSize<=tabSize/2}if(left){if(-1===prevTabStopPosition)return-1;let currentVisibleColumn=prevTabStopVisibleColumn;for(let i=prevTabStopPosition;i<lineLength;++i){if(currentVisibleColumn===prevTabStopVisibleColumn+tabSize)return prevTabStopPosition;switch(lineContent.charCodeAt(i)){case 32:currentVisibleColumn+=1;break;case 9:currentVisibleColumn=CursorColumns.nextRenderTabStop(currentVisibleColumn,tabSize);break;default:return-1}}return currentVisibleColumn===prevTabStopVisibleColumn+tabSize?prevTabStopPosition:-1}const targetVisibleColumn=CursorColumns.nextRenderTabStop(visibleColumn,tabSize);let currentVisibleColumn=visibleColumn;for(let i=position;i<lineLength;i++){if(currentVisibleColumn===targetVisibleColumn)return i;switch(lineContent.charCodeAt(i)){case 32:currentVisibleColumn+=1;break;case 9:currentVisibleColumn=CursorColumns.nextRenderTabStop(currentVisibleColumn,tabSize);break;default:return-1}}return currentVisibleColumn===targetVisibleColumn?lineLength:-1}}